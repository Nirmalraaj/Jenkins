node{
   stage('SCM Checkout'){
     git 'https://github.com/Nirmalraaj/Jenkins/'
     
  
     }
   stage('Deploy to airflow'){
    sshagent(['jenkins_tom']) {
    sh 'scp -o StrictHostKeyChecking=no /var/lib/jenkins/workspace/airflow_test/*.py  ec2-user@54.156.115.234:/home/ec2-user/airflow/dags/'
    }
    }
    stage('copy artifacts')
    {  dir('/var/lib/jenkins/jobs/airflow_test/'){
        archiveArtifacts artifacts: '**', onlyIfSuccessful: true
        sh 'pwd'
        
        }
        
       
    }
    stage('test advance script') {
            echo "current build number: ${currentBuild.number}"
            echo "previous build number: ${currentBuild.previousBuild.getNumber()}"
            def causes = currentBuild.rawBuild.getCauses()
            echo "causes: ${causes}"
            def rebuildCause0 = currentBuild.rawBuild.getCause(com.sonyericsson.rebuild.RebuildCause)
            echo "rebuildCause0: ${rebuildCause0}"
            echo "rebuild up number: ${rebuildCause0.getUpstreamBuild()}"
        }
}  
